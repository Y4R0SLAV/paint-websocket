{"ast":null,"code":"import { CanvasActionTypes } from './../../types/canvas';\nconst initialState = {\n  canvas: null,\n  undoList: [],\n  redoList: [],\n  username: \"\"\n};\nexport const canvasReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  let canvas = state.canvas;\n  let ctx = canvas === null || canvas === void 0 ? void 0 : canvas.getContext(\"2d\");\n  let newUndoList = [...state.undoList];\n  let newRedoList = [...state.redoList];\n  switch (action.type) {\n    case CanvasActionTypes.SET_CANVAS:\n      return {\n        ...state,\n        canvas: action.payload\n      };\n    case CanvasActionTypes.PUSH_TO_UNDO:\n      return {\n        ...state,\n        undoList: [...state.undoList, action.payload]\n      };\n    case CanvasActionTypes.PUSH_TO_REDO:\n      return {\n        ...state,\n        undoList: [...state.redoList, action.payload]\n      };\n    case CanvasActionTypes.UNDO:\n      if (state.undoList.length > 0 && canvas) {\n        let dataUrl = newUndoList.pop();\n        newRedoList.push(canvas.toDataURL());\n        let img = new Image();\n        img.src = dataUrl;\n        img.onload = () => {\n          ctx === null || ctx === void 0 ? void 0 : ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        };\n      } else {\n        ctx === null || ctx === void 0 ? void 0 : ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n      return {\n        ...state,\n        undoList: newUndoList,\n        redoList: newRedoList\n      };\n    case CanvasActionTypes.REDO:\n      if (state.redoList.length > 0) {\n        let dataUrl = newRedoList.pop();\n        newUndoList.push(canvas.toDataURL());\n        let img = new Image();\n        img.src = dataUrl;\n        img.onload = () => {\n          ctx === null || ctx === void 0 ? void 0 : ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        };\n      }\n      return {\n        ...state,\n        undoList: newUndoList,\n        redoList: newRedoList\n      };\n    case CanvasActionTypes.SET_USERNAME:\n      return {\n        ...state,\n        username: action.payload\n      };\n    default:\n      return state;\n  }\n};","map":{"version":3,"names":["CanvasActionTypes","initialState","canvas","undoList","redoList","username","canvasReducer","state","action","ctx","getContext","newUndoList","newRedoList","type","SET_CANVAS","payload","PUSH_TO_UNDO","PUSH_TO_REDO","UNDO","length","dataUrl","pop","push","toDataURL","img","Image","src","onload","clearRect","width","height","drawImage","REDO","SET_USERNAME"],"sources":["D:/projects/websoket-paint/client/src/store/reducers/canvasReducer.ts"],"sourcesContent":["import { CanvasState, CanvasAction, CanvasActionTypes } from './../../types/canvas'\r\n\r\nconst initialState: CanvasState = {\r\n  canvas: null,\r\n  undoList: [],\r\n  redoList: [],\r\n  username: \"\"\r\n}\r\n\r\nexport const canvasReducer = (state = initialState, action: CanvasAction): CanvasState => {\r\n  let canvas = state.canvas as HTMLCanvasElement\r\n  let ctx = canvas?.getContext(\"2d\")\r\n  let newUndoList = [...state.undoList]\r\n  let newRedoList = [...state.redoList]\r\n\r\n  switch (action.type) {\r\n    case CanvasActionTypes.SET_CANVAS: \r\n      return {...state, canvas: action.payload}\r\n\r\n    case CanvasActionTypes.PUSH_TO_UNDO: \r\n      return {...state, undoList: [...state.undoList, action.payload]}\r\n\r\n    case CanvasActionTypes.PUSH_TO_REDO: \r\n      return {...state, undoList: [...state.redoList, action.payload]}\r\n\r\n    case CanvasActionTypes.UNDO:      \r\n      if (state.undoList.length > 0 && canvas) {\r\n        let dataUrl = newUndoList.pop() as string\r\n        newRedoList.push(canvas.toDataURL())\r\n\r\n        let img = new Image()\r\n        img.src = dataUrl\r\n        img.onload = () => {\r\n          ctx?.clearRect(0, 0, canvas.width, canvas.height)\r\n          ctx?.drawImage(img, 0, 0, canvas.width, canvas.height)\r\n        }\r\n\r\n      } else {\r\n        ctx?.clearRect(0, 0, canvas.width, canvas.height)\r\n      }\r\n      return {...state, undoList: newUndoList, redoList: newRedoList}\r\n\r\n    case CanvasActionTypes.REDO:\r\n      if (state.redoList.length > 0) {\r\n        let dataUrl = newRedoList.pop() as string\r\n        newUndoList.push(canvas.toDataURL())\r\n\r\n        let img = new Image()\r\n        img.src = dataUrl\r\n        img.onload = () => {\r\n          ctx?.clearRect(0, 0, canvas.width, canvas.height)\r\n          ctx?.drawImage(img, 0, 0, canvas.width, canvas.height)\r\n        }\r\n      } \r\n      return {...state, undoList: newUndoList, redoList: newRedoList}\r\n\r\n    case CanvasActionTypes.SET_USERNAME:\r\n      return {...state, username: action.payload}\r\n\r\n    default:\r\n      return state\r\n  }\r\n} "],"mappings":"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"},"metadata":{},"sourceType":"module"}